<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Article Comments</title>
  <style>
    body {
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      padding:16px;
      max-width:720px;
      margin:auto;
      background:#fafafa;
    }
    h2 { text-align:center; margin-top:0; }
    .comment-box { display:flex; flex-direction:column; gap:8px; margin-bottom:16px; }
    input,textarea {
      font:inherit; padding:8px; border:1px solid #ccc; border-radius:6px; width:100%;
      box-sizing:border-box;
    }
    textarea { min-height:80px; resize:vertical; }
    button {
      padding:10px 16px; border:none; border-radius:6px; cursor:pointer;
      background:#1a73e8; color:#fff; font-weight:500; width:fit-content; align-self:flex-end;
      transition:background .2s;
    }
    button:hover { background:#1666c4; }
    .comment { border-bottom:1px solid #eee; padding:12px 0; }
    .meta { color:#666; font-size:.9rem; margin-bottom:4px; }
    .loading,.error { text-align:center; color:#555; margin:10px 0; }
    .error { color:red; }
  </style>
</head>
<body>
  <h2>Comments</h2>

  <div class="comment-box">
    <input id="name" placeholder="Your name (optional)" />
    <textarea id="text" placeholder="Write a comment..."></textarea>
    <button id="postBtn">Post Comment</button>
  </div>

  <div id="status" class="loading">Loading comments...</div>
  <div id="comments"></div>

  <script>
    
    const API_URL = "https://script.google.com/macros/s/AKfycbxYfisvHh3AciRsGyrhZoHjZ9Ohm7bXimDwga3OzNy49CXbz9Bt2zC3KsrnD_BPsbH9xg/exec";

    // üëá Change for each article
    const PAGE_ID = "article1";

    const nameEl = document.getElementById("name");
    const textEl = document.getElementById("text");
    const postBtn = document.getElementById("postBtn");
    const commentsEl = document.getElementById("comments");
    const statusEl = document.getElementById("status");

    async function loadComments() {
      statusEl.textContent = "Loading comments...";
      try {
        const res = await fetch(API_URL + "?page=" + PAGE_ID);
        const comments = await res.json();
        renderComments(comments);
        statusEl.textContent = "";
      } catch (err) {
        console.error(err);
        statusEl.textContent = "‚ö†Ô∏è Could not load comments.";
      }
    }

    async function postComment() {
      const name = nameEl.value.trim() || "Anonymous";
      const text = textEl.value.trim();
      if (!text) return alert("Please enter a comment!");

      postBtn.disabled = true;
      postBtn.textContent = "Posting...";
      try {
        await fetch(API_URL + "?page=" + PAGE_ID, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ page: PAGE_ID, name, comment: text }),
        });
        textEl.value = "";
        await loadComments();
      } catch (err) {
        console.error(err);
        alert("Failed to post comment.");
      } finally {
        postBtn.disabled = false;
        postBtn.textContent = "Post Comment";
      }
    }

    function renderComments(list) {
      if (!list.length) {
        commentsEl.innerHTML = "<p style='text-align:center;color:#666;'>No comments yet. Be the first!</p>";
        return;
      }
      commentsEl.innerHTML = list
        .sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp))
        .map(c=>`
          <div class="comment">
            <div class="meta">
              <strong>${escapeHtml(c.name)}</strong> ‚Äî
              ${new Date(c.timestamp).toLocaleString()}
            </div>
            <div>${escapeHtml(c.comment).replace(/\n/g,"<br>")}</div>
          </div>
        `).join("");
    }

    function escapeHtml(s) {
      return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    postBtn.addEventListener("click", postComment);
    loadComments();
  </script>
</body>
</html>
